#macro(getUnableCategories ) 
    #set($unableCategories = [  "NTUR - Not tested for unknown reason","LT - Lack of time","NTTI - Too impaired or scoring at floor on the previous visit","CI - Too cognitively impaired","TT - Too tired","TD - Too distressed", "NTPL - Physical limitation (e.g. can&#39;t write)", "FA - Forgotten aid (glasses, hearing aid)", "PD - Participant declines", "PN - Passed NART", "NA - Not part of test battery for that session", "AUR - Abandoned unknown reason" ])        
#end  

#macro(showScalarIntProperty $property $item $items )
<!-- BEGIN Generated by the showScalarProperty macro -->
#* @vtlvariable name="items" type="java.util.List" *#
    #set($value = "") 
    #set($value = $!item.getProperty($property))
    #if($value && !$value.equals(""))
         $items[$value]
    #else
        (No value set)
    #end
    #set($value = "")
<!-- END Generated by the showScalarProperty macro -->
#end

#macro(showScalarProperty $property $item $items )
<!-- BEGIN Generated by the showScalarProperty macro -->
#* @vtlvariable name="items" type="java.util.List" *#
    #set($value = "") 
    #set($valInt = 0)
    #set($value = $!item.getProperty($property))
    #if($value && !$value.equals(""))
         $items[$valInt.parseInt($value)]
    #else
        (No value set)
    #end
    #set($value = "")
<!-- END Generated by the showScalarProperty macro -->
#end


#macro(showNoYesUnableOther $property $item )
     #set ($value = "")  
    #set($value = $!item.getProperty($property))
    #if("" == $value) 
      (No value selected)
    #elseif($value)
      #if("$value" == "0") &nbsp;No #end
      #if("$value" == "1") &nbsp;Yes #end
      #if("$value" == "2") &nbsp;Unable for Health Reasons #end
      #if("$value" == "3") &nbsp;Unable, other #end
    #else 
       (Not specified)
    #end

#end


#macro(showYesNo $property $item )
    #set ($value = "")
    #set($value = $!item.getProperty($property))
    #if("" == $value) 
      (No value selected)
    #elseif($value)
      #if("$value" == "0") &nbsp;No #end
      #if("$value" == "1") &nbsp;Yes #end
    #else 
       (Not specified)
    #end

#end




#macro(showReasonUnable $property $item )  
    #getUnableCategories()
    #set ($value = "")     
    #set($value = $!item.getProperty($property))  
    #if("" == $value)   
        (No value selected)  
    #elseif($value)  
        #showScalarIntProperty($property $item $unableCategories )          
    #else      
        (No reason given)  
    #end  
#end  

#macro(showfmBoolean $property $item)
    <!-- BEGIN Generated by the showGenfiBoolean macro -->
  	#set ($value = "")

    #set($value = $!item.getProperty($property))
    #if("" == $value)
	(No value selected)

    #elseif ("$value" == "0")
        No
    #else
        Yes
    #end
    <!-- END Generated by the GenfiBoolean macro -->
#end

#macro (fmBooleanRadioYesNo $name $item $defaultValue $vr)
    #if ($vr)
      #if($vr.getField($name))
        <span style="color:red;">&#8658</span>
      #end
    #end
      #if ($item.getBooleanProperty($name,$defaultValue))
          <input type="radio" name="$name" value="0"/>&nbsp;No
      <input type="radio" name="$name" value="1" CHECKED/>&nbsp;Yes

      #else
          <input type="radio" name="$name" value="0" CHECKED/>&nbsp;No
      <input type="radio" name="$name" value="1"/>&nbsp;Yes

      #end
    #end

#macro (fmRadioYesNoUnableOtherTogglePanel $name $item $panel $vr)
    <!-- BEGIN Generated by the cmicRadioYesNoUnableOtherTogglePanel macro -->
    #set ($value = "")
    #set($value = $!item.getProperty($name))
    <!-- value: $value -->
    <input type="radio" name="$name" value="0" #if("$value" == "0") checked #end onclick="togglePanel('$panel', false);togglePanel('${panel}Y', false);"/>&nbsp;No
    <input type="radio" name="$name" value="1" #if("$value" == "1") checked #end onclick="togglePanel('$panel', false);togglePanel('${panel}Y', true);"/>&nbsp;Yes
    <input type="radio" name="$name" value="2" #if("$value" == "2") checked #end onclick="togglePanel('$panel', false);togglePanel('${panel}Y', false);"/>&nbsp;Unable for Health Reasons
     <input type="radio" name="$name" value="3" #if("$value" == "3") checked #end onclick="togglePanel('$panel', true);togglePanel('${panel}Y', false);"/>&nbsp;Unable, other (Specify)
    <!-- END Generated by the cmicRadioYesNoUnableOtherTogglePanel  macro -->
#end


#macro(fmRadioYesNo $name $item $defaultValue $vr)
  #if($item.getBooleanProperty($name,$defaultValue))
      <input type="radio" name="$name" value="0" />&nbsp;No
      <input type="radio" name="$name" value="1" CHECKED />&nbsp;Yes
  #else
      <input type="radio" name="$name" value="0"  CHECKED  />&nbsp;No
      <input type="radio" name="$name" value="1"  />&nbsp;Yes
  #end
#end



#macro(fmRadioYesNoToggle $name $item $defaultValue $panel $vr)
  #set ($value = "")
  #set($value = $!item.getProperty($name))
  <input type="radio" name="$name" value="0" #if($value == "0") CHECKED #end onclick="togglePanel('${panel}', false);"/>&nbsp;No
  <input type="radio" name="$name" value="1" #if($value == "1") CHECKED #end onclick="togglePanel('${panel}', true);"/>&nbsp;Yes
#end

#macro(fmRadioNoYesToggle $name $item $defaultValue $panel $vr)
  #set ($value = "")
  #set($value = $!item.getProperty($name))
  <input type="radio" name="$name" value="0" #if($value == "0") CHECKED #end onclick="togglePanel('${panel}', true);"/>&nbsp;No
  <input type="radio" name="$name" value="1" #if($value == "1") CHECKED #end onclick="togglePanel('${panel}', false);"/>&nbsp;Yes
#end

#macro(fmRadioYesNoBothToggle $name $item $defaultValue $panelY $panelN $vr)
  #set ($value = "")
  #set($value = $!item.getProperty($name))
  <input type="radio" name="$name" value="0" #if($value == "0") CHECKED #end onclick="togglePanel('${panelN}', true);togglePanel('${panelY}', false);"/>&nbsp;No
  <input type="radio" name="$name" value="1" #if($value == "1") CHECKED #end onclick="togglePanel('${panelN}', false);togglePanel('${panelY}', true);"/>&nbsp;Yes
#end

#macro(fmRedcapBoolToggle $name $default $panel $vals $vr)
  #set ($value = "")
  #set($value = $!item.getProperty($name))
      #if ("" == $value && "" != $default)
            #set ($value = $default)
      #end


         #set ($pInt = 1)
         #set ($p = "$panel$pInt")
         #set ($onclickY = "")
         #set ($onclickN = "")
         #foreach( $val in $vals.split(",") )
             #if("$val" == "Y")
                  #set ($onclickY = "${onclickY}togglePanel('${p}', true);")
                  #set ($onclickN = "${onclickN}togglePanel('${p}', false);")
            #else
                  #set ($onclickY = "${onclickY}togglePanel('${p}', false);")
                  #set ($onclickN = "${onclickN}togglePanel('${p}', true);")
             #end
             #set ($pInt = $pInt + 1)
             #set ($p = "$panel$pInt")
         #end
        <input type="radio" name="$name" value="0" #if($value == "0") CHECKED #end onclick="${onclickN}" />&nbsp;No
        <input type="radio" name="$name" value="1" #if($value == "1") CHECKED #end onclick="${onclickY}" />&nbsp;Yes
#end



#macro(fmGenericStringToggle $name $item $items $default $panel $vals $vr)
  #set ($value = "")
  #set($value = $!item.getProperty($name))
      #if ("" == $value && "" != $default)
            #set ($value = $default)
      #end

       #foreach($listitem in $items)
             #set ($pInt = 1)
             #set ($p = "$panel$pInt")
             #set ($onclick = "")
             #foreach( $val in $vals.split(",") )
                 #if("$listitem" == "$val")
                      #set ($onclick = "${onclick}togglePanel('${p}', true);")
                #else
                      #set ($onclick = "${onclick}togglePanel('${p}', false);")
                 #end
                 #set ($pInt = $pInt + 1)
                 #set ($p = "$panel$pInt")
             #end
              <input type="radio" name="$name" value="$listitem" #if($value == "$listitem") CHECKED #end onclick="${onclick}"  />&nbsp;$listitem
       #end

#end

#macro(renderfmScalarPropertySelect $property $item $items $vr)
    #set ($value = "")
    #set($value = $!item.getProperty($property))
    <select id="$property" name="$property">
        <option value="" #if("" == $value) selected="true" #end>(SELECT)</option>
        #set($index = 0)
        #foreach($listitem in $items)
            <option value="$index" #if ($index == $value) selected="true" #end>$listitem</option>
            #set($index = $index + 1)
        #end
    </select>
#end

#macro(renderfmIntegerDropdown $property $item $items $vr)
    #set ($value = "")
    #set($value = $!item.getProperty($property))
    <select id="$property" name="$property">
        <option value="" #if("" == $value) selected="true" #end>(SELECT)</option>
        #set($index = 0)
        #foreach($listitem in $items)
            <option value="$listitem" #if ("$listitem" == $value) selected="true" #end>$listitem</option>
        #end
    </select>
#end

#macro(renderfmStringDropdown $property $item $items $default $vr)
    #set ($value = "")
    #set($value = $!item.getProperty($property))
    #if ("" == $value && "" != $default)
            #set ($value = $default)

            <select id="$property" name="$property">

                #foreach($listitem in $items)
                    <option value="$listitem" #if ($listitem.toString().contains("$value")) selected="true" #end>$listitem</option>
                #end
           </select>
    #else
            <select id="$property" name="$property">
                <option value="" #if("" == $value) selected="true" #end>(SELECT)</option>
                #foreach($listitem in $items)
                    <option value="$listitem" #if ("$listitem" == $value) selected="true" #end>$listitem</option>
                #end
            </select>
    #end
#end


#macro(renderfmStringRadio $name $item $items $vr)
    #set($value = "")
    #set($value = $!item.getProperty($name))

      #foreach($listitem in $items)
         <input type="radio" name="$name" value="$listitem" #if($value == "$listitem") CHECKED #end />&nbsp;$listitem
      #end

#end
#macro(renderfmStringMultiRadio $name $item $items $vr)
    #set($value = "")
    #set($value = $!item.getProperty($name))

      #foreach($listitem in $items)
         <input type="radio" name="$name" value="$listitem" #if($value == "$listitem") CHECKED #end />&nbsp;$listitem
      #end

#end


#macro (fmDateBox $property $item $vr)
    #set($date = "")
    #set($rawDate = "")

    #set($rawDate = $!item.getDateProperty($property))
    #if("" == $rawDate)
        #set($date = "")
    #else
        #set($date = $turbineUtils.formatDate($!item.getDateProperty($property), "yyyy-MM-dd"))
    #end

    <input type="date" id="$property" name="$property" value="$date"/>

#end


#macro (fmDateTimev1Box $property $item $vr $num)
 <!-- datetime local does not work on firefox! -->

   <input type="text" class="hidden" name="$property" id="$property">
   <input type="text" onclick="updateDateTime('$property','$num')" class="mt10px input" name="$num" id="$num">

     <script type="text/javascript">
            $('#$num').dateTimePicker({
                mode: 'dateTime'
            });
        </script>
        <script type="text/javascript">
            function updateDateTime(property, num) {
                  document.getElementById(property).value = document.getElementById(num).value
                }
     </script>
#end


#macro (fmDateTimeLocalBox $property $item $vr)
 <!-- datetime local does not work on firefox or safari! -->
   <input type="datetime-local" name="$property" id="$property" pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}" >
#end



#macro (fmDateTimeBox $property $item $vr $num)

   <!-- input type="text"  name="$property" id="$property" -->
    #set ($value = "")
    #set($value = $!item.getProperty($property))

    #if ("" == $value)
        #set ($saveddate = "01-01-2023")
        #set ($savedtime = "12:00")
           <input type="text" class="hidden" name="$property" id="$property">
    #else
        #set ($s = $value.split("T"))
        #set ($df = $s.get(0).split("-"))
        #set ($saveddate = "$df.get(2)-$df.get(1)-$df.get(0)")
        #set ($savedtime = $s.get(1).substring(0,5))
           <input type="text" value="$value"  class="hidden" name="$property" id="$property">

    #end


   <input type="text" onchange="updateDateTime('$property','date$num', 'time$num')" value="$saveddate"  name="date$num" id="date$num">
   <input type="time" onchange="updateDateTime('$property','date$num', 'time$num')"  value="$savedtime"  name="time$num" id="time$num">

 <!-- datetime format : 2002-05-30T09:00:00-->
   <script type="text/javascript">
        function updateDateTime(property, date, time) {
                    dt = document.getElementById(date).value;
                    tm = document.getElementById(time).value;
                    dt_dt = dt.substring(6,10) + "-" +  dt.substring(3,5)  + "-" +  dt.substring(0,2);
                    tm_tm = tm.substring(0,5) + ":00";

                    document.getElementById(property).value =  dt_dt + "T" + tm_tm;

                  }
       </script>

           <script>
    $( function() {
      $( "#date$num" ).datepicker({
         dateFormat: "dd-mm-yy"
      });
    } );
        </script>

        <script>
            $(document).ready(function(){
                $('input.timepicker').timepicker({});
            });
    </script>
#end


#macro (fmTimeBox $property $item $vr $num)
 <!-- datetime local does not work on firefox! -->
     <!-- input type="text" class="hidden" name="$property" id="$property"  -->
   <!-- input type="text" class="timepicker" onchange="updatefmTime('$property', 'time$num')" value="12:00:00"    name="time$num" id="time$num" -->
      #set($value = "")
    #set($value = $!item.getProperty($property))

   <input type="text" class="timepicker" value="$value"    name="$property" id="$property">

   <script type="text/javascript">
        function updatefmTime(property,  time) {
                    document.getElementById(property).value =  document.getElementById(time).value;
                  }
       </script>

           <script>
    $( function() {
      $( "#time$num" ).timepicker({
         timeFormat: "hh:mm"

      });
    } );
        </script>

      <script>

            $(document).ready(function(){
                $('input.timepicker').timepicker({});
            });
    </script>

#end



#macro (fmBooleanCheckbox $name $item $vr $default)
    #set ($value = "")

#if ($vr)
  #if($vr.getField($name))
    <span style="color:red;">&#8658;</span>
  #end
#end
  #set($value = $!item.getBooleanProperty($name))

#if ($value)
 <input id="$name" type="checkbox" name="$name"  value="1" #if("true" == $value)  checked #end />
#else
 <input id="$name" type="checkbox" name="$name" value="1" #if("y" == $default)   checked #end />
#end

  ## The hidden box is necessary to submit a "false" value if the checkbox is unchecked
  ## If the checkbox is checked, its true value will override the hidden's "false" value
   <input type="hidden" name="$name" value="0" />
#end




#macro (fmCalcType $property $item $vr $type)
 <!-- datetime local does not work on firefox! -->
     <input type="$type" class="hidden" name="$property" id="$property">
#end

#macro (showDateTime $property $item )
 <!-- datetime local does not work on firefox! -->
    #set($value = "")
    #set($value = $!item.getProperty($property))
    #if ("" == $value)
       No date set
    #else
        #set($s = $value.split("T"))
        #set($df = $s.get(0).split("-"))
        $df.get(2)-$df.get(1)-$df.get(0) $s.get(1)
    #end

#end

#macro (showDate $property $item )
    
    #set($date = "")
    #set($rawDate = "")

    #set($rawDate = $!item.getDateProperty($property))
    #if("" == $rawDate)

          No date set
    #else 
        #set($date = $turbineUtils.formatDate($!item.getDateProperty($property), "dd-MM-yyyy"))
        $date
    #end

#end